# Домашняя работа №6

## Криптография
_Диффи Хелман, SHA, DES, SSL, TLS, HTTP/HTTPS, Certs_

### 1. Изучить этапы, методы и протоколы IPSec фреймворка
    - IKE Phase 1
    - IKE Phase 2
    - IPSec framework protocols
    - HTTP vs HTTPS

#### _Очень кратко про IPsec:_

IPsec довольно сложный протокол и представляет собой набор протоколов, которые придумали, чтобы защитить трафик в сети через:
- _аутентификацию_ (гарантия того, что пакет пришёл именно от нужного отправителя - проверка заголовков) - используется предварительный общий ключ, усиливая группой протоколов DH (Diffie Hellman) или цифровые сертификаты
- _обеспечение целостности_ (гарантия того, что по пути пакет не менялся - проверка данных) - протоколы MD5 или SHA
- _конфиденциальности_ (собственно, через шифрование, чтобы никто более не смог прочесть пакет) - используются DES, 3DES или AES
- _анти-повтора_ (исключаются дубли пакетов, которые могут оказаться подменёнными).<br>

Работает поверх IP, на сетевом уровне. После инициирования IPsec создаёт туннель между двумя пирами (это P2P - Peer-to-peer протокол) в два этапа (фазы) за счёт протокола IKE (Internet Key Exchange). <br>
Уже из перевода понятно, что делает IKE - Интернет-обмен ключами.<br>
На первой фазе (IKE phase 1) пиры договариваются о Security Association (SA): это значит о том, какие протоколы будут использоваться для реализации функий IPsec и других параметрах, а также устанавливают между собой туннель ISAKMP (Internet Security Association and Key Management Protocol) только для того, чтобы безопасно перейти на вторую фазу (IKE phase 2).<br>
Вот когда туннели установлены, подключаются и протоколы, о которых пиры договорились - ESP (Encapsulating Security Payload) или AH (Authentication Header), происходит передача данных и завершение (туннель IPsec закрывается).

#### _Про HTTP И HTTPS:_

Главное отличие: веб-протокол HTTPS - это защищённый сертификатом траффик, здесь участвует протокол SSL/TLS. На самом деле не только веб, но и другие типы трафика сейчас защищаются сертификатами (например, тот же почтовый трафик, т.е. SMTP/POP3/IMAP протоколы).
    
### 2. SSH Best Practice:
    - На VM Uubuntu настроить SSH по лучшим практикам
    - Сгенерировать на Windows host либо Kali linux VM (ssh-keygen) приватный и публичный ключ,
        добавить ключ (замок) ssh-add либо scp на ubuntu VM где настроили ssh
    - Подключиться к ubuntu VM используя приватный ключ

Лучшие практики на то и названы лучшими, что позволяют лучше обеспечить безопасность.<br>
Использовать актуальное ПО (старые дыры закрыты, новые ещё могут быть и не найдены) и убирать то, что не используется - эти два правила относятся не только к SSH, а, впрочем, ко всему ПО.<br>
#### _Про SSH_:<br>
Конфиг - ```/etc/ssh/sshd_config``` - всё настраивается там (прежде всего нужно бы сделать копию, мало ли чего).<br>
После изменения файла требуется перезагрузка службы<br>
```systemctl restart sshd```

_Те самые "лучше практики" для SSH:_<br>
- Указать версию протокола 2 - ```Protocol 2```
- Не держать SSH открытым для всех: сменить порт (```Port```) и ограничить его через фаерволл (iptables, например)
- Отключить авторизацию из файла .rhosts, по хосту и пустые пароли<br>
```IgnoreRhosts yes```<br>
```PermitEmptyPasswords no```<br>
```HostbasedAuthentication no```<br>
- Отключить авторизацию по паролю и настроить авторизацию по ключу<br>
```PasswordAuthentication no```<br>
```PubkeyAuthentication yes```<br>
```AuthorizedKeysFile      .ssh/authorized_keys .ssh/authorized_keys2```<br>

Я подключаюсь к своему серверу через PuTTY по ключу:

![](pics/ssh-4.png)<br>
![](pics/ssh-1.png)<br>
![](pics/ssh-2.png)<br>
![](pics/ssh-3.png)<br>
   

### 3. WireGuard VPN. *
    - Развернуть Ubuntu с двумя сетевыми интерфейсами.
        Один - в интернет, другой - во внутреннюю сеть, к которой у вас подключены WS и Kali.
        Настроить на ней возможность подключения по RDP и SSH c WS. Срок - неделя. 
    - Установить и настроить WireGuard VPN на Ubuntu
    - Установить агент VPN Wireguard на хостовую машину 
    - Установить VPN соединение между хостовой машиной и Ubuntu с VPN Wireguard  

Ссылки на дополнительные ресурсы:<br>
      [Что такое IPSec и как это работает](https://networklessons.com/cisco/ccie-routing-switching/ipsec-internet-protocol-security)<br>
      [Лучшие практики по настройке SSH](https://wiki.merionet.ru/articles/luchshie-praktiki-po-zashhite-ssh-podklyucheniya)<br>
      [Установка и конфиграция Wireguard VPN Ubuntu](https://habr.com/ru/sandbox/189100/)<br>
      [Отличие и безопаность HTTP vs HTTPS](https://www.cloudflare.com/learning/ssl/why-is-http-not-secure/#:~:text=The%20only%20difference%20between%20the,far%20more%20secure%20than%20HTTP.)<br>
